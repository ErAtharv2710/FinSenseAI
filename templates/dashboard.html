<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinSense - Financial Literacy for Youth</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Authentication Section -->
    <section id="auth-section" class="active-section">
        <div class="auth-container">
            <div class="auth-card">
                <div class="logo-area">
                    <i class="fas fa-wallet logo-icon"></i>
                    <h1>FinSense</h1>
                    <p>Master Your Money, Master Your Life</p>
                </div>

                <div class="auth-tabs">
                    <button class="tab-btn active" onclick="switchToSignIn()">Sign In</button>
                    <button class="tab-btn" onclick="switchToCreateAccount()">Create Account</button>
                </div>

                <!-- Sign In Form -->
                <form id="sign-in-form" class="auth-form active" onsubmit="submitSignInForm(event)">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email" required>
                        <span class="error-msg" id="login-email-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="login-password" placeholder="Min 8 chars" required minlength="8">
                            <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility(this)"></i>
                        </div>
                        <span class="error-msg" id="login-password-error"></span>
                    </div>

                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" id="remember-device">
                            <span class="checkmark"></span>
                            Remember this device
                        </label>
                        <a href="#" class="forgot-pass">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                    <button type="button" class="btn btn-outline btn-block" onclick="requestEmailCodeForSignIn()">Sign
                        In with Email OTP</button>

                    <div id="login-otp-area" class="hidden fade-in">
                        <div class="form-group">
                            <label for="login-otp">Verification Code</label>
                            <input type="text" id="login-otp" placeholder="6-digit code" maxlength="6">
                        </div>
                    </div>

                    <div class="security-note">
                        <p><i class="fas fa-shield-alt"></i> We never ask for bank PIN, card number, or CVV.</p>
                    </div>
                </form>

                <!-- Create Account Form -->
                <form id="create-account-form" class="auth-form" onsubmit="submitCreateAccountForm(event)">
                    <div class="form-group">
                        <label for="reg-name">Full Name</label>
                        <input type="text" id="reg-name" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-display-name">Display Name</label>
                        <input type="text" id="reg-display-name" placeholder="Nickname for leaderboard" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" placeholder="john@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-mobile">Mobile Number</label>
                        <input type="tel" id="reg-mobile" placeholder="+1 234 567 8900" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-pass">Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="reg-pass" placeholder="Create password" required minlength="8">
                            <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility(this)"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-pass">Confirm Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="reg-confirm-pass" placeholder="Confirm password" required
                                minlength="8">
                            <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility(this)"></i>
                        </div>
                        <span class="error-msg" id="reg-error-msg"></span>
                    </div>

                    <button type="button" class="btn btn-outline btn-block"
                        onclick="requestEmailCodeForRegistration()">Send Verification Code to Email</button>

                    <div id="reg-otp-area" class="hidden fade-in">
                        <div class="form-group">
                            <label for="reg-otp">Verification Code</label>
                            <input type="text" id="reg-otp" placeholder="6-digit code" maxlength="6">
                        </div>
                    </div>

                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" id="agree-terms" required>
                            <span class="checkmark"></span>
                            I agree to Terms & Privacy Policy
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Create My FinSense Account</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Main App Shell -->
    <div id="app-shell" class="hidden">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="nav-left">
                <button id="mobile-menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <div class="nav-brand">
                    <i class="fas fa-wallet logo-icon-sm"></i>
                    <span>FinSense</span>
                </div>
            </div>

            <div class="nav-center">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search topics, quests...">
                </div>
            </div>

            <div class="nav-right">
                <div class="user-dropdown-container">
                    <div class="user-mini-profile" onclick="toggleUserDropdown()">
                        <img src="https://ui-avatars.com/api/?name={{ username }}&background=00C853&color=fff"
                            alt="User" id="nav-user-avatar">
                        <span class="nav-user-name">{{ username }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div id="user-dropdown" class="dropdown-menu hidden">
                        <a href="#" onclick="openUserProfile()"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" onclick="goToSection('settings')"><i class="fas fa-cog"></i> Settings</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" onclick="handleSignOut()" class="text-danger"><i class="fas fa-sign-out-alt"></i>
                            Sign Out</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <ul class="nav-links">
                    <li onclick="openDashboard()" class="active" id="nav-dashboard"><i class="fas fa-home"></i>
                        <span>Dashboard</span></li>
                    <li onclick="openLearningAcademy()" id="nav-academy"><i class="fas fa-graduation-cap"></i>
                        <span>Learning Academy</span></li>
                    <li onclick="openDailyQuests()" id="nav-quests"><i class="fas fa-scroll"></i> <span>Daily
                            Quests</span></li>
                    <li onclick="openArcadeGames()" id="nav-arcade"><i class="fas fa-gamepad"></i> <span>Arcade
                            Games</span></li>
                    <li onclick="openMarketLab()" id="nav-market"><i class="fas fa-chart-line"></i> <span>Market
                            Lab</span></li>
                    <li onclick="openFinSenseCoach()" id="nav-coach"><i class="fas fa-robot"></i> <span>FinSense
                            Coach</span></li>
                    <li onclick="openTeamArena()" id="nav-arena"><i class="fas fa-fist-raised"></i> <span>Team
                            Arena</span></li>
                    <li onclick="openHallOfFame()" id="nav-hall"><i class="fas fa-trophy"></i> <span>Hall of Fame</span>
                    </li>
                    <li onclick="goToSection('settings')" id="nav-settings"><i class="fas fa-cog"></i>
                        <span>Settings</span></li>
                </ul>
            </aside>

            <!-- Main Content Area -->
            <main class="content-area">

                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <div class="dashboard-header">
                        <h2>Dashboard</h2>
                        <p class="date-display">Today is <span id="current-date"></span></p>
                    </div>

                    <div class="dashboard-grid">
                        <!-- AI Driven Cards -->
                        <div class="card ai-card" id="aiSummaryBlock">
                            <div class="card-header">
                                <h3><i class="fas fa-lightbulb accent-icon"></i> Today's Money Tip</h3>
                            </div>
                            <div class="card-body">
                                <p id="dailyAdviceText">"Compound interest is the eighth wonder of the world. He who
                                    understands it, earns it... he who doesn't... pays it." - Albert Einstein</p>
                            </div>
                        </div>

                        <div class="card" id="spendingSnapshot">
                            <div class="card-header">
                                <h3>Spending Snapshot</h3>
                            </div>
                            <div class="card-body">
                                <div class="progress-group">
                                    <div class="progress-label"><span>Needs</span> <span>50%</span></div>
                                    <div class="progress-bar">
                                        <div class="fill" style="width: 50%; background-color: #3B82F6;"></div>
                                    </div>
                                </div>
                                <div class="progress-group">
                                    <div class="progress-label"><span>Wants</span> <span>30%</span></div>
                                    <div class="progress-bar">
                                        <div class="fill" style="width: 30%; background-color: #F59E0B;"></div>
                                    </div>
                                </div>
                                <div class="progress-group">
                                    <div class="progress-label"><span>Savings</span> <span>20%</span></div>
                                    <div class="progress-bar">
                                        <div class="fill" style="width: 20%; background-color: #10B981;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card" id="questProgress">
                            <div class="card-header">
                                <h3>Quest Progress</h3>
                            </div>
                            <div class="card-body">
                                <h4>Current: Budget Master</h4>
                                <div class="progress-bar-lg">
                                    <div class="fill" style="width: 75%;"></div>
                                </div>
                                <p class="mt-2 text-muted">75% Complete</p>
                                <div class="recommendation-box" id="aiRecommendationList">
                                    <p><strong>Next Step:</strong> Review your weekly expenses in the Academy.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- User Profile Section -->
                <section id="user-profile" class="content-section">
                    <h2>User Profile</h2>
                    <div class="profile-layout">
                        <div class="card profile-sidebar">
                            <div class="profile-avatar-lg">
                                <img src="https://ui-avatars.com/api/?name={{ username }}&background=00C853&color=fff&size=128"
                                    alt="Profile">
                            </div>
                            <h3 class="text-center">{{ username }}</h3>
                            <p class="text-center text-muted">john@example.com</p>
                            <hr>
                            <div class="profile-stats-list">
                                <div class="stat-row"><span>Age Group:</span> <span>18-24</span></div>
                                <div class="stat-row"><span>City:</span> <span>New York</span></div>
                            </div>
                        </div>
                        <div class="card profile-content">
                            <h3>Edit Profile</h3>
                            <form onsubmit="updateUserProfile(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Display Name</label>
                                        <input type="text" value="{{ username }}" id="edit-display-name">
                                    </div>
                                    <div class="form-group">
                                        <label>City</label>
                                        <input type="text" value="New York" id="edit-city">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Age Group</label>
                                    <select id="edit-age">
                                        <option>Under 18</option>
                                        <option selected>18-24</option>
                                        <option>25-34</option>
                                    </select>
                                </div>

                                <div class="settings-toggles">
                                    <label class="switch-row">
                                        <span>Email notifications</span>
                                        <input type="checkbox" checked id="toggle-email-notif">
                                    </label>
                                    <label class="switch-row">
                                        <span>Show my profile on leaderboard</span>
                                        <input type="checkbox" checked id="toggle-leaderboard">
                                    </label>
                                </div>

                                <div class="profile-actions">
                                    <button type="submit" class="btn btn-primary">Save Profile Changes</button>
                                    <button type="button" class="btn btn-outline"
                                        onclick="startChangePasswordFlow()">Change Password</button>
                                    <button type="button" class="btn btn-danger"
                                        onclick="confirmAccountDeletion()">Delete My Account</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Learning Academy -->
                <section id="learning-academy" class="content-section">
                    <h2>Learning Academy</h2>
                    <div class="academy-container">
                        <div class="lesson-list">
                            <div class="card lesson-item" onclick="selectLesson(1)">
                                <h4>Budgeting 101</h4>
                                <span class="badge badge-easy">Beginner</span>
                            </div>
                            <div class="card lesson-item" onclick="selectLesson(2)">
                                <h4>Credit Scores</h4>
                                <span class="badge badge-medium">Intermediate</span>
                            </div>
                            <div class="card lesson-item" onclick="selectLesson(3)">
                                <h4>Investing Basics</h4>
                                <span class="badge badge-hard">Advanced</span>
                            </div>
                        </div>
                        <div class="lesson-detail card">
                            <div id="lesson-content-placeholder">
                                <h3>Select a lesson to start</h3>
                                <p>Unlock your financial potential with our curated modules.</p>
                            </div>
                            <div id="active-lesson-content" class="hidden">
                                <h3 id="active-lesson-title">Lesson Title</h3>
                                <p id="active-lesson-desc">Lesson description goes here...</p>
                                <div class="lesson-actions">
                                    <button class="btn btn-primary">Start Lesson</button>
                                    <button class="btn btn-outline">Take Quiz</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Daily Quests -->
                <section id="daily-quests" class="content-section">
                    <h2>Daily Quests</h2>
                    <div class="quest-grid">
                        <div class="card quest-card">
                            <div class="quest-icon"><i class="fas fa-calendar-check"></i></div>
                            <h4>Login Streak</h4>
                            <p>Log in for 3 consecutive days.</p>
                            <div class="quest-meta">
                                <span class="badge badge-easy">Easy</span>
                                <span class="reward">+50 XP</span>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="startNewQuest('streak')">Begin
                                Quest</button>
                        </div>
                        <div class="card quest-card">
                            <div class="quest-icon"><i class="fas fa-piggy-bank"></i></div>
                            <h4>Super Saver</h4>
                            <p>Save 20% of your income in simulation.</p>
                            <div class="quest-meta">
                                <span class="badge badge-medium">Medium</span>
                                <span class="reward">+100 XP</span>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="startNewQuest('saver')">Begin Quest</button>
                        </div>
                    </div>
                </section>

                <!-- Arcade Games -->
                <section id="arcade-games" class="content-section">
                    <h2>Arcade Games</h2>
                    <div class="arcade-grid">
                        <div class="card game-card">
                            <div class="game-thumb" style="background-color: #ef4444;">BS</div>
                            <h3>Bill Splitter Run</h3>
                            <button class="btn btn-primary" onclick="openGameModal('Bill Splitter Run')">Play</button>
                        </div>
                        <div class="card game-card">
                            <div class="game-thumb" style="background-color: #3b82f6;">SS</div>
                            <h3>Savings Sprint</h3>
                            <button class="btn btn-primary" onclick="openGameModal('Savings Sprint')">Play</button>
                        </div>
                    </div>
                </section>

                <!-- Market Lab -->
                <section id="market-lab" class="content-section">
                    <h2>Market Lab</h2>
                    <div class="market-container card">
                        <div class="market-controls">
                            <div class="form-group">
                                <label>Instrument</label>
                                <select id="market-instrument">
                                    <option>TechCorp (TCP)</option>
                                    <option>GreenEnergy (GNR)</option>
                                    <option>SafeBond (SBD)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Investment Amount</label>
                                <input type="number" id="market-amount" value="100">
                            </div>
                            <div class="market-buttons">
                                <button class="btn btn-success" onclick="simulateMarketOutcome()">Simulate
                                    Outcome</button>
                                <button class="btn btn-outline" onclick="resetMarketSim()">Reset</button>
                            </div>
                        </div>
                        <div class="market-results" id="market-result-box">
                            <p class="text-muted">Results will appear here...</p>
                        </div>
                    </div>
                </section>

                <!-- FinSense Coach -->
                <section id="finsense-coach" class="content-section">
                    <h2>FinSense Coach</h2>
                    <div class="coach-container card">
                        <div class="coach-header">
                            <select id="coach-mode">
                                <option>Quick Question</option>
                                <option>Explain this concept</option>
                                <option>Review my week</option>
                            </select>
                        </div>
                        <div class="chat-history" id="chat-history">
                            <div class="message coach-msg">
                                <div class="bubble">Hello! I'm your FinSense Coach. How can I help you today?</div>
                            </div>
                        </div>
                        <div class="chat-input-row">
                            <input type="text" id="coach-input" placeholder="Ask your coach...">
                            <button class="btn btn-primary" onclick="sendMessageToCoach()">Ask Coach</button>
                            <button class="btn btn-outline" onclick="sendMessageToCoach('Explain My Last Game')">Explain
                                My Last Game</button>
                        </div>
                    </div>
                </section>

                <!-- Team Arena -->
                <section id="team-arena" class="content-section">
                    <h2>Team Arena</h2>
                    <div class="arena-tabs-container">
                        <button class="tab-btn active" onclick="switchArenaTab('coop')">Play Together</button>
                        <button class="tab-btn" onclick="switchArenaTab('versus')">Face a Friend</button>
                    </div>
                    <div class="card arena-panel">
                        <div class="room-management">
                            <input type="text" placeholder="Enter Room Code" id="room-code">
                            <button class="btn btn-primary" onclick="createNewRoom()">Create New Room</button>
                            <button class="btn btn-outline" onclick="joinExistingRoom()">Join Room</button>
                        </div>
                        <hr>
                        <div class="team-status">
                            <h4>Team Savings Goal</h4>
                            <div class="progress-bar">
                                <div class="fill" style="width: 0%;"></div>
                            </div>
                            <div class="arena-log" id="arena-log">
                                <p class="text-muted">Waiting for players...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Hall of Fame -->
                <section id="hall-of-fame" class="content-section">
                    <h2>Hall of Fame</h2>
                    <div class="card leaderboard-card">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Display Name</th>
                                    <th>XP</th>
                                    <th>TrustScore</th>
                                    <th>City</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                    <h3>Badges</h3>
                    <div class="badge-grid">
                        <div class="card badge-item">
                            <i class="fas fa-rocket badge-icon"></i>
                            <h4>Early Bird</h4>
                            <p>Joined in Beta</p>
                        </div>
                        <div class="card badge-item">
                            <i class="fas fa-star badge-icon"></i>
                            <h4>Top Saver</h4>
                            <p>Saved 1000 Coins</p>
                        </div>
                    </div>
                </section>

                <!-- Settings -->
                <section id="settings" class="content-section">
                    <h2>Settings</h2>
                    <div class="card settings-card">
                        <div class="setting-row">
                            <span>Dark Mode</span>
                            <label class="switch">
                                <input type="checkbox" checked onchange="toggleColorTheme()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <span>In-app Sounds</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <hr>
                        <button class="btn btn-outline" onclick="console.log('Exporting data...')">Export My
                            Data</button>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="delete-account-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Delete Account</h3>
            <p class="text-danger">Warning: This action is irreversible. All your data will be lost.</p>
            <div class="form-group">
                <label>Re-enter Password</label>
                <input type="password" class="form-control" placeholder="Password">
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger"
                    onclick="console.log('Account deleted'); document.getElementById('delete-account-modal').classList.add('hidden');">Yes,
                    delete my account</button>
                <button class="btn btn-outline"
                    onclick="document.getElementById('delete-account-modal').classList.add('hidden')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="game-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal"
                onclick="document.getElementById('game-modal').classList.add('hidden')">&times;</span>
            <h2 id="modal-game-title">Game Title</h2>
            <div class="game-placeholder-area">
                <p>Game area placeholder</p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>